# AI 테마 생성 모드 설계 — 4관점 리뷰 & 결정

> 날짜: 2026-02-10
> 선행 작업: `2026-02-09_theme-multi-model.md` (멀티 모델 인프라 구현 완료)

---

## 배경

멀티 모델 인프라가 완성됨 (Claude Sonnet / GPT-4o / Gemini Flash, 프로바이더 팩토리).
다음 단계로 **관리자/사용자 UX 개선**을 검토:

1. Admin: 3개 모델에 enabled/isRecommended 토글 6개 → 복잡하고 실수 유발
2. 고급 모드: Gemini로 초안 → Claude로 검증/개선하는 파이프라인 아이디어
3. 사용자 UI: 에디터에서 기본/고급 모드 선택

4가지 관점(PM, 고객, 백엔드, 사장)으로 리뷰 진행.

---

## 비용 구조

| 모델 | 예상 비용/생성 | 속도 | 마진률 (크레딧 100원 가정) |
|------|--------------|------|----------------------|
| Gemini 2.5 Flash | ~$0.002 (~3원) | ~2초 | 97% |
| GPT-4o | ~$0.034 (~50원) | ~3초 | 50% |
| Claude Sonnet 4.5 | ~$0.049 (~72원) | ~5초 | 28% |
| 파이프라인 (Gemini→Claude) | ~$0.051 (~75원) | ~8초 | 25% |

---

## 1. PM 관점

### "기본/고급" 네이밍 문제
- **"기본 = 열등한 것"** 프레이밍. 청첩장은 인생 한 번 이벤트인데 "기본"을 선택한 사용자에게 감정적 불만 유발
- 이건 단순 네이밍 문제가 아니라 **제품 포지셔닝 문제**
- AI 테마 생성 자체가 "와, AI가 만들어주네!"라는 가치를 줘야 하는데 기본/고급 분리가 그 가치를 훼손

### 고급 모드 품질 차이 — 미검증
- 모든 프로바이더가 **동일한 시스템 프롬프트** + **동일한 JSON Schema 제약**을 사용
- 차이는 "색상 조합 감각", "타이포그래피 매칭" 정도인데 크레딧 2배를 정당화할 만큼 체감 가능한지 불확실
- 결혼하는 커플이 두 테마를 놓고 "어느 게 고급인지" 구분할 수 있을까?

### MVP scope
- **1단계 (즉시)**: Admin 단일 모델 선택 UI. 실수 방지가 핵심
- **2단계 (보류)**: 고급 모드는 A/B 품질 비교 데이터 필요 (동일 프롬프트 30개 비교)

### 전환율 영향
- 선택지 추가 = AI 테마 생성 버튼 클릭 전 고민 증가 = **전환율 하락 위험**
- 무료 크레딧 2개 상태에서 "고급 2크레딧"이면 무료 사용자는 한 번에 소진 → 이탈 위험

---

## 2. 고객 관점 (예비 신부/신랑)

### 결정 피로
결혼 준비 중 예식장/스드메/혼수로 결정 피로 극심. 이 상태에서 원하는 건:
**"내가 원하는 느낌을 말하면 예쁜 게 나오는 것"**

"기본 vs 고급" 선택이 유발하는 사고 과정:
1. "뭐가 다르지?" (이해 비용)
2. "크레딧 2개밖에 없는데..." (계산 비용)
3. "기본이 별로면 어차피 낭비 아닌가?" (불안)
4. "고급이 진짜 더 좋긴 한가?" (의구심)

→ **이 사고 과정 자체가 UX 실패**

### 실제로 원하는 것
1. 빠르게 예쁜 결과
2. 마음에 안 들면 "다시 만들기"로 빠른 재시도
3. **"이 부분만 바꿔줘" (부분 수정)** — "고급 모드"보다 100배 가치 있음

### 크레딧 인식
"2크레딧 중 고급은 전부 소모" → "이 서비스는 인색하다"는 인상

---

## 3. 백엔드 개발자 관점

### 파이프라인 복잡도 (구현할 경우)

```
1단계: Gemini → rawJson → sanitize → Zod parse → validatedTheme
2단계: Claude에게 "이 테마를 개선해줘" + validatedTheme 전달
     → tool_use → refinedRawJson → sanitize → Zod parse → finalTheme
```

**문제점:**

**(a) 프롬프트 엔지니어링 난이도**
- 2단계에서 기존 테마 JSON 전체(~3000 토큰)를 함께 전달해야 함
- "무엇을 개선할지" 기준이 모호 (색상 조화? 가독성? 미적 감각?)
- Claude가 Gemini 결과를 이해 못하고 전면 재작성할 가능성

**(b) 부분 실패 처리**
```
deductCredits(2) → Gemini 성공 → Claude 실패 → ???
```
- 2크레딧 전액 환불 + Gemini 결과 버림? (가장 안전)
- 1크레딧만 환불 + Gemini 결과 반환? (UX 혼란)
- 전액 환불 + Gemini 결과 반환? (사업적 손해)

**(c) Latency**
- Gemini: 1.5~3초 + Claude: 3~6초 = **총 4.5~9초**
- 모바일에서 8초 대기는 매우 길다

**(d) DB 스키마**
파이프라인이면 추가 컬럼 필요: `mode`, `pipelineStep1ModelId`, `pipelineStep2ModelId` 등

**(e) "검증+개선"이 정말 더 좋은 결과를 만드는가?**
- 가설일 뿐 사실이 아님
- 오히려 잘 된 부분을 불필요하게 변경할 위험
- **검증 없이 구현하면 "비싸기만 하고 결과는 비슷하거나 나쁜" 기능이 될 위험**

---

## 4. 사장 관점 (1인 운영)

### 비용/마진 분석
- 기본(Gemini): 마진 97% → 10번 재생성해도 Claude 1번보다 저렴
- 고급(파이프라인): 마진 25% → 매출 증가 보장 안 됨
- 테마 생성은 사용자당 2~5번. 고급 선택 비율이 높으면 무료 크레딧만 빠르게 소진

### 운영 복잡도
- 현재: "테마 안 만들어져요" → 로그에서 modelId + 에러 확인
- 파이프라인: 1단계인지 2단계인지 → 중간 결과 → 2단계 프롬프트 → 크레딧 환불... **디버깅 경로 2배**

### 더 나은 대안
"Gemini를 기본으로 쓰고, 불만족 시 재생성 유도":
- $0.002 × 10번 재생성 = $0.02 < Claude 1번($0.049)
- 사용자 경험: 고민 없이 바로 생성, 마음에 들 때까지 재시도
- 운영: 단순, 디버깅 쉬움

---

## 종합 결론

### 파이프라인(Gemini→Claude 2단계)은 하지 않는다

| 이유 | 설명 |
|------|------|
| 품질 미검증 | 동일 프롬프트 + 동일 Schema 제약 하에서 체감 차이 불확실 |
| 복잡도 과다 | 2단계 에러 처리, 크레딧 로직, latency 2배 |
| 운영 부담 | 1인 운영에서 디버깅 경로 2배는 치명적 |
| 마진 하락 | 97% → 25%인데 매출 증가 보장 없음 |

### 채택한 방안: 직접 호출 + 세그먼트 컨트롤

```
"빠른 생성" ⚡ = Gemini Flash 직접 호출 (1크레딧, ~2초, $0.002)
"정밀 생성" ✨ = Claude Sonnet 직접 호출 (1크레딧, ~5초, $0.049)
```

- 파이프라인 없이 모델만 다르게 → 구현 단순, 운영 쉬움
- 크레딧 동일 (1) → 차별은 속도+품질로, 가격이 아님
- "기본/고급" 대신 **"빠른/정밀"** 네이밍 → 열등감 없는 중립적 표현
- 관리자가 각 모드에 배정할 모델을 라디오 버튼으로 선택

---

## 구현 계획

### Admin UI — 테마 탭

```
┌─────────────────────────────────────────┐
│  빠른 생성 모델                           │
│  ○ Gemini 2.5 Flash  ~$0.002  ⚡빠름     │  ← 라디오
│  ○ GPT-4o            ~$0.034  ⚡빠름     │
│  ○ Claude Sonnet 4.5 ~$0.049  ⏱보통     │
├─────────────────────────────────────────┤
│  정밀 생성 모델                           │
│  ○ Claude Sonnet 4.5 ~$0.049  ⏱보통     │  ← 라디오
│  ○ GPT-4o            ~$0.034  ⚡빠름     │
│  ○ Gemini 2.5 Flash  ~$0.002  ⚡빠름     │
└─────────────────────────────────────────┘
```

### User UI — TemplateTab 세그먼트 컨트롤

```
┌──────────────┬──────────────┐
│  ⚡ 빠른 생성  │  ✨ 정밀 생성  │
└──────────────┴──────────────┘
  ~2초, 1크레딧      ~5초, 1크레딧
```

### 설정 저장

`appSettings` 테이블 활용 (신규 마이그레이션 불필요):
```json
{
  "key": "theme_generation_config",
  "value": { "fastModelId": "theme-gemini-flash", "qualityModelId": "theme-claude-sonnet" },
  "category": "ai",
  "label": "테마 생성 모드 설정"
}
```

### API 변경

```typescript
// POST /api/ai/theme
{ prompt, invitationId?, mode?: 'fast' | 'quality' }
// mode 미지정 시 'fast' 기본값
```

### 파일 변경 목록

| # | 파일 | 변경 |
|---|------|------|
| 1 | `lib/ai/theme-models.ts` | `ThemeMode` 타입 추가 |
| 2 | `app/api/admin/ai-models/route.ts` | `themeConfig` 반환/저장 |
| 3 | `app/admin/ai-models/page.tsx` | 토글 → 라디오 그룹 |
| 4 | `app/api/ai/theme/route.ts` | `mode` 기반 resolveThemeModel |
| 5 | `components/editor/tabs/TemplateTab.tsx` | 세그먼트 컨트롤 추가 |

---

## 향후 고려사항

- 동일 프롬프트 30개에 대해 Gemini/Claude/GPT-4o A/B 품질 비교 → 데이터 기반 모델 선택 최적화
- "부분 수정" 기능 (색상만 바꾸기, 폰트만 바꾸기) → 고객이 실제로 가장 원하는 기능
- 데이터 축적 후 파이프라인 재검토 가능
