# AI ì›¨ë”© í¬í†  ìƒì„± ì‹œìŠ¤í…œ â€” ê¸°íšì„œ

> Cuggu AI Wedding Photo Generation System
> ì‘ì„±ì¼: 2026-02-11

---

## 1. ê°œìš”

### 1-1. ë°°ê²½

CugguëŠ” í•œêµ­ ì‹œì¥ íƒ€ê²Ÿ ëª¨ë°”ì¼ ì²­ì²©ì¥ í”Œë«í¼ì´ë‹¤.
AI ì›¨ë”© ì‚¬ì§„ ìƒì„±ì´ í•µì‹¬ ì°¨ë³„í™” í¬ì¸íŠ¸ì´ë©°, í˜„ì¬ ë‹¨ì¼ ì¸ë¬¼(ì‹ ë‘ OR ì‹ ë¶€) ì‚¬ì§„ì—
10ê°€ì§€ ìŠ¤íƒ€ì¼ì„ ì ìš©í•´ 4ì¥ ë°°ì¹˜ë¡œ ìƒì„±í•˜ëŠ” ì‹œìŠ¤í…œì´ êµ¬í˜„ë˜ì–´ ìˆë‹¤.

### 1-2. ëª©í‘œ

- **ì»¤í”Œ ì‚¬ì§„ í•©ì„±**: ë‘ ì‚¬ëŒ(ì‹ ë‘+ì‹ ë¶€) ì‚¬ì§„ì„ ë°›ì•„ í•¨ê»˜ ì°ì€ ê²ƒì²˜ëŸ¼ ìƒì„±
- **í…Œë§ˆ/ì´¬ì˜ì§€ ê¸°ë°˜**: ì œì£¼, íŒŒë¦¬, ë² ë„¤ì¹˜ì•„ ë“± ì‹¤ì œ ì›¨ë”© ì´¬ì˜ ì¥ì†Œ ì»¨ì…‰
- **ë©€í‹°ìŠ¤í… íŒŒì´í”„ë¼ì¸**: í•œ ë²ˆì— ì™„ë²½í•  í•„ìš” ì—†ì´, ì—¬ëŸ¬ ê³¼ì •ì„ ê±°ì³ ì´ˆê³ í’ˆì§ˆ ë‹¬ì„±
- **ì‹¤ì œ íŒë§¤ ê°€ëŠ¥í•œ í’ˆì§ˆ**: ê²°í˜¼ì„ ì¤€ë¹„í•˜ëŠ” ì»¤í”Œì—ê²Œ ì‹¤ì œë¡œ íŒ” ìˆ˜ ìˆëŠ” ìˆ˜ì¤€

### 1-3. ì œì•½ ì¡°ê±´

- ë¹„ìš©ì€ ìš°ì„  ê³ ë ¤í•˜ì§€ ì•ŠìŒ (í’ˆì§ˆ ìµœìš°ì„ )
- 1ì¸ ìš´ì˜ ê°€ëŠ¥í•œ ë³µì¡ë„ ìœ ì§€
- ê¸°ì¡´ ì‹œìŠ¤í…œê³¼ í•˜ìœ„ í˜¸í™˜

---

## 2. ì‹œì¥ ë¶„ì„

### 2-1. ì‹œì¥ ê·œëª¨

- í•œêµ­ ì—°ê°„ ê²°í˜¼ ì»¤í”Œ: ~20ë§Œ ìŒ
- ëª¨ë°”ì¼ ì²­ì²©ì¥ ì‚¬ìš©ë¥ : 70%+ â†’ íƒ€ê²Ÿ ì‹œì¥ ì•½ 14ë§Œ ì»¤í”Œ/ë…„
- ì›¨ë”© ì‚¬ì§„ ìŠ¤íŠœë””ì˜¤ ì‹œì¥: 1ì¡°ì›+ (ì»¤í”Œë‹¹ 200~500ë§Œì›)
- AI í”„ë¡œí•„ ì‹œì¥ ê²€ì¦ ì™„ë£Œ: 2023ë…„ Snow/Meitu AI í”„ë¡œí•„ ë¶ìœ¼ë¡œ í•œêµ­ ì†Œë¹„ìì˜ AI ì‚¬ì§„ ê²°ì œ ì˜í–¥ í™•ì¸

### 2-2. ê²½ìŸ í™˜ê²½

| í”Œë ˆì´ì–´ | ì„œë¹„ìŠ¤ | ê°­ |
|---------|--------|-----|
| ë°”ë¥¸/ë³´ì´ìŠ¤ì¹´ë“œ/ì²­ì²©ì¥ë§Œë“¤ê¸° | í…œí”Œë¦¿ ê¸°ë°˜ ì²­ì²©ì¥, ì‚¬ì§„ ì—…ë¡œë“œ | AI ìƒì„± ì—†ìŒ. ì™„ì „ commodity |
| Snow/Meitu | ë‹¨ì¼ ì¸ë¬¼ AI í”„ë¡œí•„ | ì»¤í”Œ í•©ì„± ì—†ìŒ, ì›¨ë”© íŠ¹í™” ì•„ë‹˜ |
| ë“œë¦¬ë¯¸/AIì›¨ë”©ìŠ¤ëƒ… (ì‹ ìƒ) | AI ì›¨ë”© ì‚¬ì§„ ë‹¨ë… íŒë§¤ | ì²­ì²©ì¥ê³¼ ë²ˆë“¤ ì•„ë‹˜. ë³„ë„ êµ¬ë§¤ ë§ˆì°° |
| Canva/ë¯¸ë¦¬ìº”ë²„ìŠ¤ | ë””ìì¸ ë„êµ¬ | ë²”ìš©. AI ì–¼êµ´ í•©ì„± ì—†ìŒ |

**í•µì‹¬ ì°¨ë³„í™”**: ëª¨ë°”ì¼ ì²­ì²©ì¥ + AI ì»¤í”Œ ì›¨ë”© ì‚¬ì§„ì„ ê²°í•©í•œ ê²½ìŸì ì—†ìŒ

### 2-3. ìˆ˜ìµ ì¶”ì •

- ì „í™˜ìœ¨ 10%, í‰ê·  ê°ë‹¨ê°€ 30,000ì› ê°€ì •
- ì—° ë§¤ì¶œ: 14ë§Œ x 10% x 3ë§Œì› = **4.2ì–µì›** (AI ë‹¨ë…)
- ì²­ì²©ì¥ ë²ˆë“¤ë§ìœ¼ë¡œ ê°ë‹¨ê°€ ìƒí–¥ ì‹œ: ì—° 10~20ì–µì› TAR

---

## 3. ì œí’ˆ ì „ëµ

### 3-1. í¬ì§€ì…”ë‹

> **"ìš°ë¦¬ ë‘˜ë§Œì˜ ë“œë¦¼ ì›¨ë”© ìŠ¤ëƒ… â€” AIê°€ ë§Œë“œëŠ” ê¿ˆì˜ ì›¨ë”© ì•¨ë²”"**

- ì‹¤ì œ ì´¬ì˜ "ëŒ€ì²´"ê°€ ì•„ë‹˜ â†’ ìŠ¤íŠœë””ì˜¤ê°€ **ëª»í•˜ëŠ” ê²ƒ**ì„ AIë¡œ
- ì›¨ë”© ì´¬ì˜ ì „ ë¯¸ë¦¬ë³´ê¸° (preview)
- í•´ì™¸ ì´¬ì˜ ëŠë‚Œì˜ ë³´ì¶© ì•¨ë²” (supplementary)
- ì²­ì²©ì¥ ë©”ì¸ ì‚¬ì§„ (hero image)
- "cheap alternative"ê°€ ì•„ë‹Œ "dream experience"

### 3-2. ê°€ê²© ì „ëµ

| í‹°ì–´ | ê°€ê²© | êµ¬ì„± |
|------|------|------|
| Free | 0ì› | AI ì»¤í”Œ ì‚¬ì§„ 1ì¥ (ì›Œí„°ë§ˆí¬), ê¸°ë³¸ ì²­ì²©ì¥ |
| Starter | 19,900ì› | ì²­ì²©ì¥ + AI ì»¤í”Œ ì‚¬ì§„ 4ì¥ (1 í…Œë§ˆ), ì›Œí„°ë§ˆí¬ ì œê±° |
| Premium | 39,900ì› | ì²­ì²©ì¥ + AI ì»¤í”Œ ì‚¬ì§„ 12ì¥ (3 í…Œë§ˆ), í”„ë¦¬ë¯¸ì—„ í…œí”Œë¦¿ |
| Album | 69,900ì› | ì²­ì²©ì¥ + AI ì»¤í”Œ ì‚¬ì§„ 30ì¥ (ì „ì²´ í…Œë§ˆ), ì•¨ë²” ë‹¤ìš´ë¡œë“œ |

- êµ¬ë… ëª¨ë¸ ì•„ë‹˜ (ê²°í˜¼ì€ ì¼íšŒì„± ì´ë²¤íŠ¸)
- ì²­ì²©ì¥ê³¼ ë²ˆë“¤ íŒë§¤ (AI ì‚¬ì§„ ë‹¨ë… íŒë§¤ ì•„ë‹˜)
- ë¬´ë£Œ ì›Œí„°ë§ˆí¬ ì‚¬ì§„ì´ í•µì‹¬ ì „í™˜ ë„êµ¬

### 3-3. ì‚¬ìš©ì ì—¬ì • & ì „í™˜ í¬ì¸íŠ¸

```mermaid
flowchart TD
    A["ğŸ” ë°œê²¬<br/>(ì¸ìŠ¤íƒ€/ì¹´ì¹´ì˜¤/ë°”ì´ëŸ´ ê³µìœ )"] --> B["ğŸ  ëœë”© í˜ì´ì§€<br/>AI ì»¤í”Œ ì‚¬ì§„ ì˜ˆì‹œê°€ Hero"]
    B --> C{"â­ ì „í™˜ì  1<br/>ì–¼êµ´ ì‚¬ì§„ ì—…ë¡œë“œ<br/>(ì‹ ë‘+ì‹ ë¶€)"}
    C -->|"ì‚¬ì§„ ì¢‹ìŒ âœ“"| D["ì›Œí„°ë§ˆí¬ í”„ë¦¬ë·°<br/>CTA: ì›Œí„°ë§ˆí¬ ì œê±° + ë” ë§ì€ í…Œë§ˆ"]
    C -->|"ì‚¬ì§„ ë‚˜ì¨ âœ—"| X["âŒ ì´íƒˆ<br/>(ì˜êµ¬ ì†ì‹¤)"]
    D --> E{"â­ ì „í™˜ì  2<br/>ê²°ì œ (19,900ì›~)<br/>ì¹´ì¹´ì˜¤í˜ì´/í† ìŠ¤"}
    E --> F["í…Œë§ˆ ì„ íƒ â†’ ë” ë§ì€ ì‚¬ì§„ ìƒì„±<br/>â†’ AI ì‚¬ì§„ìœ¼ë¡œ ì²­ì²©ì¥ ì œì‘"]
    F --> G{"â­ ì „í™˜ì  3<br/>ì²­ì²©ì¥ ê³µìœ "}
    G --> H["ğŸ“¨ ìˆ˜ì‹ ìê°€ AI ì‚¬ì§„ í™•ì¸<br/>'ì´ê±° ë­ì•¼? ë‚˜ë„ ë§Œë“¤ê³  ì‹¶ë‹¤!'"]
    H --> A

    style C fill:#FFD700,stroke:#333,color:#000
    style E fill:#FFD700,stroke:#333,color:#000
    style G fill:#FFD700,stroke:#333,color:#000
    style X fill:#FF6B6B,stroke:#333,color:#fff
```

### 3-4. ë°”ì´ëŸ´ ë£¨í”„

```mermaid
flowchart LR
    A["ì»¤í”Œì´<br/>AI ì‚¬ì§„ ìƒì„±"] --> B["ì²­ì²©ì¥ì—<br/>AI ì‚¬ì§„ ì‚½ì…"]
    B --> C["ì¹´ì¹´ì˜¤/ë§í¬ë¡œ<br/>ì²­ì²©ì¥ ê³µìœ "]
    C --> D["ìˆ˜ì‹ ì 100~500ëª…<br/>ì²­ì²©ì¥ ì—´ëŒ"]
    D --> E["'ì´ ì‚¬ì§„ ë­ì•¼?'<br/>í˜¸ê¸°ì‹¬ ìœ ë°œ"]
    E --> F["í•˜ë‹¨ CTA í´ë¦­<br/>â†’ ëœë”© í˜ì´ì§€"]
    F --> A

    style A fill:#4ECDC4,stroke:#333,color:#000
    style F fill:#4ECDC4,stroke:#333,color:#000
```

ì²­ì²©ì¥ ê³µìœ  = ìì—° ê´‘ê³ . ëª¨ë“  ìˆ˜ì‹ ìê°€ ì ì¬ ê³ ê°.
AI ì‚¬ì§„ì€ "ì´ê±° ì–´ë–»ê²Œ ë§Œë“  ê±°ì•¼?"ë¼ëŠ” í˜¸ê¸°ì‹¬ì„ ìœ ë°œí•˜ëŠ” í›….

### 3-5. ë¦¬ìŠ¤í¬ í‰ê°€

| ë¦¬ìŠ¤í¬ | ì‹¬ê°ë„ | ëŒ€ì‘ |
|--------|--------|------|
| **ì–¼êµ´ ì™œê³¡/ì–¸ìºë‹ˆë°¸ë¦¬** | Critical | ë©€í‹°ìŠ¤í…, ì–¼êµ´ ê²€ì¦, ì¬ìƒì„± ì˜µì…˜ |
| **ì»¤í”Œ í•©ì„± í’ˆì§ˆ** | Critical | Phase 0ì—ì„œ ì„ í–‰ ê²€ì¦. ì•ˆ ë˜ë©´ ì œí’ˆ ì¬ì„¤ê³„ |
| **ê¸°ëŒ€ì¹˜ vs í˜„ì‹¤ ê´´ë¦¬** | High | "AI ì•„íŠ¸" ëª…í™•íˆ í”„ë ˆì´ë°, ì˜ˆì‹œ ë¯¸ë¦¬ í‘œì‹œ |
| **ìƒì„± ì›ê°€** | Medium | ë†’ì€ ê°€ê²©ëŒ€ë¡œ í¡ìˆ˜, íŒŒì´í”„ë¼ì¸ ìµœì í™” |
| **ì´ˆìƒê¶Œ/ë™ì˜** | Medium | ì–‘ì¸¡ ëª…ì‹œì  ë™ì˜ ì²´í¬ë°•ìŠ¤, ì•½ê´€ ì •ë¹„ |
| **ê²½ìŸì ëª¨ë°©** | Low | ì„ ì ì ìš°ìœ„ + ì²­ì²©ì¥ ë²ˆë“¤ ë°©ì–´ë²½ 6~12ê°œì›” |

---

## 4. í˜„ì¬ ì‹œìŠ¤í…œ ë¶„ì„

### 4-1. ì•„í‚¤í…ì²˜

```mermaid
flowchart LR
    subgraph Client["í´ë¼ì´ì–¸íŠ¸"]
        UI["React UI<br/>(AIPhotoGenerator)"]
    end

    subgraph API["Next.js API Routes"]
        GEN["/api/ai/generate-stream<br/>(SSE)"]
    end

    subgraph Orchestrator["ì˜¤ì¼€ìŠ¤íŠ¸ë ˆì´í„°"]
        GW["generateWeddingPhotosStream()"]
        BP["buildPrompt(style, role)"]
    end

    subgraph Providers["AI í”„ë¡œë°”ì´ë”"]
        REP["Replicate<br/>Flux Pro/Dev, PhotoMaker"]
        OAI["OpenAI<br/>GPT Image 1, DALL-E 3"]
        GEM["Gemini<br/>2.5 Flash"]
    end

    subgraph Infra["ì¸í”„ë¼"]
        S3["AWS S3 +<br/>CloudFront"]
        FACE["Azure<br/>Face API"]
        REDIS["Upstash<br/>Redis"]
        DB["PostgreSQL<br/>(Supabase)"]
    end

    UI -->|"ì‚¬ì§„ ì—…ë¡œë“œ"| GEN
    GEN --> REDIS
    GEN --> FACE
    GEN --> GW
    GW --> BP
    GW --> REP & OAI & GEM
    REP & OAI & GEM --> S3
    GW -->|"SSE: 1ì¥ì”© ì „ì†¡"| UI
    GEN --> DB
```

**í˜„ì¬ í”Œë¡œìš°**: ì‚¬ì§„ 1ì¥ ì—…ë¡œë“œ â†’ `buildPrompt(style, role)` â†’ `provider.generateImage()` â†’ S3 â†’ 4ì¥ ë°˜í™˜

### 4-2. íŒŒì¼ êµ¬ì¡°

```
lib/ai/
â”œâ”€â”€ generate.ts              # ì˜¤ì¼€ìŠ¤íŠ¸ë ˆì´í„° (ë™ê¸° + ìŠ¤íŠ¸ë¦¬ë°)
â”œâ”€â”€ models.ts                # AIModel ì •ì˜ (6ê°œ ëª¨ë¸)
â”œâ”€â”€ prompts.ts               # 10 ìŠ¤íƒ€ì¼ í”„ë¡¬í”„íŠ¸ + buildPrompt()
â”œâ”€â”€ providers/
â”‚   â”œâ”€â”€ types.ts             # GenerationProvider ì¸í„°í˜ì´ìŠ¤
â”‚   â”œâ”€â”€ index.ts             # getProvider() ë¼ìš°í„°
â”‚   â”œâ”€â”€ openai.ts            # GPT Image 1 (edit), DALL-E 3 (generate)
â”‚   â”œâ”€â”€ gemini.ts            # Gemini 2.5 Flash (generateContent)
â”‚   â””â”€â”€ replicate.ts         # Flux Pro/Dev, PhotoMaker
â”œâ”€â”€ face-detection.ts        # Azure Face API (ì‚¬ì „ ê²€ì¦)
â”œâ”€â”€ s3.ts                    # S3 ì—…ë¡œë“œ/ë³µì‚¬
â”œâ”€â”€ credits.ts               # í¬ë ˆë”§ ê´€ë¦¬
â”œâ”€â”€ rate-limit.ts            # Rate limiting
â”œâ”€â”€ validation.ts            # ì´ë¯¸ì§€ ê²€ì¦
â”œâ”€â”€ constants.ts             # ì„¤ì •ê°’
â”œâ”€â”€ env.ts                   # í™˜ê²½ë³€ìˆ˜
â””â”€â”€ logger.ts                # êµ¬ì¡°í™”ëœ ë¡œê¹…

app/api/ai/
â”œâ”€â”€ generate/route.ts        # POST (ë™ê¸°)
â”œâ”€â”€ generate-stream/route.ts # SSE ìŠ¤íŠ¸ë¦¬ë°
â”œâ”€â”€ generations/route.ts     # GET íˆìŠ¤í† ë¦¬
â”œâ”€â”€ select/route.ts          # POST ì‚¬ì§„ ì„ íƒ
â””â”€â”€ models/route.ts          # GET ëª¨ë¸ ëª©ë¡
```

### 4-3. í˜„ì¬ ëª¨ë¸ í˜„í™©

| ëª¨ë¸ | í”„ë¡œë°”ì´ë” | ì–¼êµ´ ë³´ì¡´ | ë¹„ìš©/ì¥ | ì°¸ì¡° ì´ë¯¸ì§€ |
|------|-----------|----------|---------|-----------|
| Flux 1.1 Pro | Replicate | Fair | $0.04 | O |
| Flux Dev | Replicate | Fair | $0.025 | O |
| PhotoMaker | Replicate | Excellent | $0.0095 | O |
| GPT Image 1 | OpenAI | Good | $0.04 | O (edit) |
| DALL-E 3 | OpenAI | Poor | $0.04 | X |
| Gemini 2.5 Flash | Google | Good | $0.02 | O |

ì£¼ì„ ì²˜ë¦¬ë¨: InstantID (Excellent, $0.0095), SDXL FaceID (Excellent, $0.005)

### 4-4. í•µì‹¬ ì œì•½

- `GenerationProvider.generateImage()`ê°€ ë‹¨ì¼ ì´ë¯¸ì§€(`imageUrl`) 1ê°œë§Œ ì…ë ¥ë°›ìŒ
- ì»¤í”Œ(2ì¸) í•©ì„±ì„ í•˜ë ¤ë©´ ì¸í„°í˜ì´ìŠ¤ í™•ì¥ í•„ìš”
- í”„ë¡¬í”„íŠ¸ê°€ ë„ˆë¬´ ë‹¨ìˆœ: "handsome Korean groom" + ìŠ¤íƒ€ì¼ ì„¤ëª… 1ì¤„
- ì–¼êµ´ ë³´ì¡´ ì§€ì‹œê°€ ë¶€ì‹¤: "keeping the exact same face" í•œ ì¤„
- í¬í† ë¦¬ì–¼ë¦¬ì¦˜/í•œêµ­ ì›¨ë”© ìŠ¤íƒ€ì¼ íŠ¹ì„± ë¯¸ë°˜ì˜

---

## 5. AI ëª¨ë¸ ì „ëµ

### 5-1. í”„ë¡œë°”ì´ë” ìš°ì„ ìˆœìœ„

```mermaid
quadrantChart
    title AI ëª¨ë¸ í¬ì§€ì…”ë‹ (ì–¼êµ´ ë³´ì¡´ vs ë¹„ìš©)
    x-axis "ì €ë ´" --> "ë¹„ìŒˆ"
    y-axis "ì–¼êµ´ ë³´ì¡´ ì•½í•¨" --> "ì–¼êµ´ ë³´ì¡´ ê°•í•¨"
    quadrant-1 "Production ì£¼ë ¥"
    quadrant-2 "Budget ëŒ€ì•ˆ"
    quadrant-3 "Deprecate"
    quadrant-4 "ë¹„ìš© ëŒ€ë¹„ ë¶€ì¡±"
    "GPT Image 1": [0.75, 0.70]
    "Gemini Flash": [0.40, 0.65]
    "PhotoMaker": [0.15, 0.90]
    "InstantID": [0.15, 0.88]
    "Flux Pro": [0.75, 0.35]
    "Flux Dev": [0.50, 0.30]
    "DALL-E 3": [0.75, 0.15]
```

**Tier 1 (Production â€” ì£¼ë ¥)**
- **GPT Image 1** (OpenAI): ìµœê³  í’ˆì§ˆ, ì–¼êµ´ ë³´ì¡´ Good, edit ëª¨ë“œë¡œ ì°¸ì¡° ì´ë¯¸ì§€ ì§€ì›
  - `input_fidelity: 'high'` íŒŒë¼ë¯¸í„° ì‚¬ìš© ê°€ëŠ¥ ì—¬ë¶€ í™•ì¸ í•„ìš”
  - GPT Image 1.5 ì¶œì‹œ ì—¬ë¶€ í™•ì¸ í•„ìš” (ë¦¬ì„œì¹˜ì—ì„œ ì–¸ê¸‰ë¨)
- **Gemini 2.5 Flash** (Google): ì»¤í”Œ ì‚¬ì§„ ìµœì  (ë„¤ì´í‹°ë¸Œ ë©€í‹° ì´ë¯¸ì§€ í“¨ì „), ê°€ì„±ë¹„ ìµœê³ 

**Tier 2 (Fallback/Budget)**
- **PhotoMaker V2** (Replicate): ë‹¨ì¼ ì¸ë¬¼ ì–¼êµ´ ë³´ì¡´ Excellent, ìµœì €ê°€
- **InstantID** (Replicate): ì¬í™œì„±í™” ê²€í† , ë‹¨ì¼ ì¸ë¬¼ ì–¼êµ´ ë³´ì¡´ Excellent

**Tier 3 (Deprecate)**
- Flux Pro/Dev: ì–¼êµ´ ë³´ì¡´ Fair â€” ì›¨ë”© ì‚¬ì§„ì— ë¶€ì í•©
- DALL-E 3: ì°¸ì¡° ì´ë¯¸ì§€ ë¯¸ì§€ì› â€” ì‚¬ìš© ì˜ë¯¸ ì—†ìŒ

### 5-2. ì»¤í”Œ ì‚¬ì§„ ëª¨ë¸ ë§¤ì¹­

| ì ‘ê·¼ë²• | ëª¨ë¸ | ì¥ì  | ë‹¨ì  |
|--------|------|------|------|
| **Gemini ë©€í‹°ì´ë¯¸ì§€ í“¨ì „** | Gemini 2.5 Flash | ë„¤ì´í‹°ë¸Œ 2ì¸ ì§€ì›, ì €ë ´ | í’ˆì§ˆ ë³€ë™ |
| **GPT Image edit** | GPT Image 1 | ìµœê³  í’ˆì§ˆ | 2ì¸ ë™ì‹œ ì§€ì› ê²€ì¦ í•„ìš” |
| **ìˆœì°¨ í•©ì„±** | PhotoMaker + Inpainting | ì–¼êµ´ ìµœê°• | 3ë²ˆ í˜¸ì¶œ, ì´ìŒìƒˆ ë°œìƒ |
| **Generate + FaceSwap** | Flux Pro + face-swap | ë°°ê²½ í’ˆì§ˆ ìµœê³  | 2ë‹¨ê³„ ë³µì¡ë„ |

### 5-3. ìŠ¤í…ë³„ ìµœì  ëª¨ë¸ (ë©€í‹°ìŠ¤í… íŒŒì´í”„ë¼ì¸)

| ìŠ¤í… | Primary | Fallback | ê·¼ê±° |
|------|---------|----------|------|
| ì–¼êµ´ ì¶”ì¶œ | Azure Face API + Sharp | - | ê°ì§€+í¬ë¡­ |
| ë°°ê²½ ìƒì„± | Flux Pro (Replicate) | DALL-E 3 | í¬í† ë¦¬ì–¼ ì”¬ ìµœê³  |
| í•©ì„± | GPT Image 1 (edit) | Gemini 2.5 Flash | ë©€í‹° ì°¸ì¡° ì´ë¯¸ì§€ |
| í›„ì²˜ë¦¬ | Flux Dev (img2img) | Sharp (ë¡œì»¬) | ì—…ìŠ¤ì¼€ì¼/ìƒ‰ë³´ì • |

---

## 6. í”„ë¡¬í”„íŠ¸ ì—”ì§€ë‹ˆì–´ë§ ì „ëµ

### 6-1. í˜„ì¬ í”„ë¡¬í”„íŠ¸ ë¬¸ì œì 

```
í˜„ì¬:
"handsome Korean groom in elegant black tuxedo and bow tie,
 Transform the scene into a classic, elegant studio wedding portrait..."

ë¬¸ì œ:
- ì¸ë¬¼ ë¬˜ì‚¬ê°€ 1ì¤„ë¡œ ë„ˆë¬´ ì§§ìŒ
- ì–¼êµ´ ë³´ì¡´ ì§€ì‹œê°€ í”„ë¡¬í”„íŠ¸ ëì— í•œ ì¤„ ("keeping the exact same face")
- í¬í† ë¦¬ì–¼ë¦¬ì¦˜ ì§€ì‹œ ì—†ìŒ (AI ëŠë‚Œ ë‚˜ëŠ” ê²°ê³¼ë¬¼)
- í•œêµ­ ì›¨ë”© ì‚¬ì§„ íŠ¹ìœ ì˜ ìŠ¤íƒ€ì¼ ë¯¸ë°˜ì˜
- ë„¤ê±°í‹°ë¸Œ í”„ë¡¬í”„íŠ¸ ë¯¸ì‚¬ìš© (Replicate ì œì™¸)
- ì¹´ë©”ë¼/ë Œì¦ˆ ì„¤ì • ë¯¸ì§€ì •
```

### 6-2. ìƒˆ í”„ë¡¬í”„íŠ¸ êµ¬ì¡°

```mermaid
block-beta
    columns 1
    block:prompt["ì™„ì„± í”„ë¡¬í”„íŠ¸"]
        columns 2
        A["ğŸ‘¤ ì¸ë¬¼ ë¬˜ì‚¬<br/>(ì‹ ë‘/ì‹ ë¶€/ì»¤í”Œ)"]
        B["ğŸï¸ ì”¬/ë°°ê²½/ì¥ì†Œ<br/>(í…Œë§ˆ í…œí”Œë¦¿)"]
        C["ğŸ’‘ í¬ì¦ˆ<br/>(ì»¤í”Œì¼ ë•Œ)"]
        D["ğŸ‡°ğŸ‡· í•œêµ­ ì›¨ë”© ìŠ¤íƒ€ì¼<br/>(K-drama ê°ì„±)"]
        E["ğŸ“· ì¹´ë©”ë¼ ì„¤ì •<br/>(Canon R5, 85mm f/1.4)"]
        F["ğŸ”’ ì–¼êµ´ ë³´ì¡´ ë¸”ë¡<br/>(CRITICAL)"]
        G["ğŸ“¸ í¬í† ë¦¬ì–¼ë¦¬ì¦˜<br/>(í”¼ë¶€ ì§ˆê°, í•„ë¦„ ê·¸ë ˆì¸)"]
        H["ğŸš« ë„¤ê±°í‹°ë¸Œ ì œì•½<br/>(ì›Œí„°ë§ˆí¬, ì™œê³¡ ë°©ì§€)"]
    end

    style A fill:#E8F5E9,stroke:#333
    style B fill:#E3F2FD,stroke:#333
    style C fill:#FFF3E0,stroke:#333
    style D fill:#FCE4EC,stroke:#333
    style E fill:#F3E5F5,stroke:#333
    style F fill:#FFCDD2,stroke:#333
    style G fill:#E0F7FA,stroke:#333
    style H fill:#EFEBE9,stroke:#333
```

### 6-3. í•µì‹¬ í”„ë¡¬í”„íŠ¸ ë¸”ë¡

#### ì–¼êµ´ ë³´ì¡´ ë¸”ë¡ (ëª¨ë“  í”„ë¡¬í”„íŠ¸ í•„ìˆ˜)

```
FACE PRESERVATION (CRITICAL - DO NOT IGNORE):
- Preserve the person's face from the reference image with 100% accuracy
- Keep identical: facial bone structure, eye shape, nose shape, lip shape, jawline, chin
- Keep identical: skin tone, skin texture with natural pores, moles, and subtle imperfections
- Keep identical: eyebrow shape and thickness, ear shape
- Maintain natural facial proportions - no stretching, no smoothing, no beautification
- The person must be immediately recognizable as the same individual
```

#### í•œêµ­ ì›¨ë”© ìŠ¤íƒ€ì¼ ë¸”ë¡

```
Professional Korean wedding photography style (í•œêµ­ ì›¨ë”© ì‚¬ì§„):
- Soft, dreamy, romantic atmosphere with natural elegance
- Shot like a professional Korean wedding studio (ìŠ¤íŠœë””ì˜¤ ì›ê·œ, ì•ˆì •ìš° ìŠ¤íƒ€ì¼)
- Warm but natural color grading, similar to Kodak Portra 400 film
- Soft diffused lighting, no harsh shadows
- Clean composition with couple as clear focal point
- Natural, relaxed poses as if captured in an authentic moment
- Shallow depth of field with creamy bokeh background
- Subtle warm tone overall color temperature (5200-5600K)
- Natural skin rendering with soft glow, no heavy retouching look
- White, cream, and pastel tones in wardrobe and environment
- The image should evoke the feeling of a Korean drama romantic scene
```

#### í¬í† ë¦¬ì–¼ë¦¬ì¦˜ ë¸”ë¡

```
PHOTOREALISM REQUIREMENTS:
- This must look like a real photograph taken by a professional photographer
- Include natural skin texture: visible pores, subtle skin imperfections, natural moles
- Natural eye reflections with visible catchlights
- Realistic fabric texture: visible thread patterns, natural wrinkles and folds
- Natural hair texture: individual strands visible, natural shine and volume
- Realistic depth of field with natural bokeh
- Subtle film grain reminiscent of Kodak Portra 400
- Natural color science: no oversaturated or HDR look
- The image should feel honest, candid, and unposed even in posed shots
```

#### ë„¤ê±°í‹°ë¸Œ ì œì•½ ë¸”ë¡

```
ABSOLUTE EXCLUSIONS:
- No watermarks, text, logos, signatures, or overlaid graphics
- No extra fingers, missing fingers, fused fingers, malformed hands
- No deformed face, asymmetrical face, crossed eyes, dead eyes
- No plastic skin, waxy skin, poreless airbrushed skin
- No uncanny valley effect, mannequin look, doll-like appearance
- No cartoon, anime, illustration, painting, drawing, or sketch style
- No 3D render, CGI, digital art look
- No blurry, low resolution, jpeg artifacts, or compression artifacts
- No extra limbs, missing limbs, floating body parts
- No visible seams, edge artifacts, green screen look, composite errors
```

### 6-4. ì¸ë¬¼ ë¬˜ì‚¬

```
ì‹ ë‘:
"A handsome Korean groom wearing an elegant tailored dark navy tuxedo with satin lapels,
 crisp white dress shirt, and silk bow tie. Well-groomed hair, confident yet gentle expression."

ì‹ ë¶€:
"A beautiful Korean bride wearing an elegant white wedding gown with delicate lace details
 and a flowing cathedral-length veil. Natural nude-tone makeup, soft wavy hair with minimal
 accessories, radiant gentle smile."

ì»¤í”Œ:
"A Korean wedding couple. The groom (Image 1) wears an elegant tailored dark navy tuxedo.
 The bride (Image 2) wears an elegant white wedding gown with delicate lace details.
 Both have warm, natural expressions."
```

### 6-5. ì»¤í”Œ í¬ì¦ˆ í…œí”Œë¦¿

| í¬ì¦ˆ | í”„ë¡¬í”„íŠ¸ |
|------|---------|
| ì†ì¡ê¸° | standing side by side, holding hands gently, both looking at the camera with warm natural smiles |
| ì„œë¡œ ë°”ë¼ë³´ê¸° | facing each other slightly, gazing into each other's eyes with gentle smiles, foreheads almost touching |
| ë°±í—ˆê·¸ | groom standing behind bride, arms wrapped gently around her waist, bride's hand resting on his arm |
| ì´ë§ˆ í‚¤ìŠ¤ | groom gently kissing bride's forehead, bride closing eyes with serene smile, intimate moment |
| í•¨ê»˜ ê±·ê¸° | walking hand in hand along the path, candid mid-stride, laughing naturally together |
| ì–´ê¹¨ ê¸°ëŒ€ê¸° | seated close together, bride leaning her head on groom's shoulder, peaceful moment |
| ë³¼ ë§ëŒ€ê¸° | standing close, cheeks touching, both smiling at camera, natural and warm |
| ì—…ê¸° | groom giving bride a playful piggyback ride, both laughing joyfully, candid and fun |

### 6-6. í”„ë¡œë°”ì´ë”ë³„ í”„ë¡¬í”„íŠ¸ ìµœì í™”

#### OpenAI (GPT Image 1)
- ì‚¬ì§„ ì–¸ì–´ ì‚¬ìš© (ë Œì¦ˆ, ì¡°ëª…, í”„ë ˆì´ë°) â€” ì•„íŠ¸/ì¼ëŸ¬ìŠ¤íŠ¸ ì–¸ì–´ ê¸ˆì§€
- ì¹´ë©”ë¼ ì§€ì •: "Shot on Canon EOS R5 with 85mm f/1.4 lens"
- ì§ˆê° ìš”ì²­: "visible pores, natural skin texture, subtle imperfections"
- ì–¼êµ´ í¬í•¨ ì´ë¯¸ì§€ë¥¼ **ì²« ë²ˆì§¸**ë¡œ ë°°ì¹˜ (ì²« 5ì¥ì´ ë†’ì€ fidelity)
- í¸ì§‘ ì‹œ: "Change only X" + "Keep everything else the same"

#### Gemini (2.5 Flash)
- ì´ë¯¸ì§€ë¥¼ **í”„ë¡¬í”„íŠ¸ ì•ì—** ë°°ì¹˜
- ìºë¦­í„° ì •ì˜ë¥¼ ëª…í™•íˆ ë°˜ë³µ: "Image 1 shows the groom. Image 2 shows the bride."
- ìºë¦­í„° ë“œë¦¬í”„íŠ¸ ë°©ì§€: "keep the same person" ë°˜ë³µ
- ë³€ê²½ì€ ë‹¨ê³„ì ìœ¼ë¡œ (iterative prompts)

#### Replicate (PhotoMaker)
- íŠ¸ë¦¬ê±° ì›Œë“œ `img` í•„ìˆ˜: "A photo of a img person as..."
- `style_strength_ratio` ë‚®ì¶œìˆ˜ë¡ ì–¼êµ´ ë³´ì¡´ ê°•í™” (10~20 ê¶Œì¥)
- `num_steps` ë†’ì¼ìˆ˜ë¡ í’ˆì§ˆ í–¥ìƒ (25~35 ê¶Œì¥)
- negative_prompt íŒŒë¼ë¯¸í„° í™œìš©

### 6-7. í•œêµ­ ì›¨ë”© ì‚¬ì§„ ìƒ‰ê° í”„ë¦¬ì…‹

| í”„ë¦¬ì…‹ | ì„¤ëª… |
|--------|------|
| Classic Warm | Warm pastel, lifted shadows, desaturated reds, creamy highlights, Kodak Portra 400 |
| Bright Airy | High key, white/cream dominant, minimal contrast, soft ethereal glow |
| Film Nostalgic | Warm amber, gentle vignette, visible grain, faded blacks, vintage warmth |
| Natural Clean | Accurate skin tones, minimal post-processing, true-to-life with slight warmth |
| Sunset Romantic | Golden hour warmth, amber/peach tones, lens flare, warm shadows |

---

## 7. í…Œë§ˆ/ì´¬ì˜ì§€ ì‹œìŠ¤í…œ

### 7-1. í…Œë§ˆ ìš°ì„ ìˆœìœ„

```mermaid
mindmap
  root(("í…Œë§ˆ<br/>ë¡œë“œë§µ"))
    **Tier 1 â€” MVP**
      ì œì£¼ ì›¨ë”© ìŠ¤ëƒ…
        ì˜¬ë ˆê¸¸
        í˜‘ì¬í•´ë³€
        ì„±ì‚°ì¼ì¶œë´‰
      í´ë˜ì‹ ìŠ¤íŠœë””ì˜¤
        í™”ì´íŠ¸
        í¬ë¦¼
        ë¸”ë™
      í•œë³µ ì›¨ë”©
        ê²½ë³µê¶
        í•œì˜¥ë§ˆì„
        ëŒ€ë‚˜ë¬´ìˆ²
      ë²šê½ƒ ìŠ¤ëƒ…
        ë²šê½ƒê¸¸
        ê³µì›
        ê°•ë³€
    Tier 2 â€” ê²€ì¦ í›„
      íŒŒë¦¬
        ì—í íƒ‘
        ì„¼ê°•
        ëª½ë§ˆë¥´íŠ¸
      ê°€ì„ ë‹¨í’
        ë‚¨ì´ì„¬
        ê²½ì£¼
      ë¹„ì¹˜/ë°œë¦¬
    Tier 3 â€” ì´í›„
      ë² ë„¤ì¹˜ì•„
      ì‚°í† ë¦¬ë‹ˆ
      ì‹œì¦Œ/ê¸°ë…ì¼
      íŒíƒ€ì§€/ì‹œë„¤ë§ˆí‹±
```

#### Tier 1 â€” MVP ëŸ°ì¹˜ (4ì¢…)

| í…Œë§ˆ | ì¹´í…Œê³ ë¦¬ | ì„œë¸Œ ë¡œì¼€ì´ì…˜ | ì„ ì • ê·¼ê±° |
|------|---------|-------------|----------|
| **ì œì£¼ ì›¨ë”© ìŠ¤ëƒ…** | êµ­ë‚´ | ì˜¬ë ˆê¸¸, í˜‘ì¬í•´ë³€, ì„±ì‚°ì¼ì¶œë´‰, í•œë¼ì‚° | êµ­ë‚´ 1ìœ„ ì›¨ë”© ì´¬ì˜ì§€ |
| **í´ë˜ì‹ ìŠ¤íŠœë””ì˜¤** | ìŠ¤íŠœë””ì˜¤ | í™”ì´íŠ¸, í¬ë¦¼, ë¸”ë™ ë°°ê²½ | ê°€ì¥ ë³´í¸ì  ì²­ì²©ì¥ ì‚¬ì§„ |
| **í•œë³µ ì›¨ë”©** | êµ­ë‚´ | ê²½ë³µê¶, í•œì˜¥ë§ˆì„, ëŒ€ë‚˜ë¬´ìˆ² | íŠ¸ë Œë“œ ìƒìŠ¹, í•œêµ­ ì°¨ë³„í™” |
| **ë²šê½ƒ ìŠ¤ëƒ…** | êµ­ë‚´ | ë²šê½ƒê¸¸, ê³µì›, ê°•ë³€ | ê°ì„±ì , ì‹œì¦Œ ë¬´ê´€ "ê¿ˆ" ì»¨í…ì¸  |

#### Tier 2 â€” ê²€ì¦ í›„ í™•ì¥

- íŒŒë¦¬ (ì—í íƒ‘, ì„¼ê°•, ëª½ë§ˆë¥´íŠ¸, ìƒ¹ì ¤ë¦¬ì œ)
- ê°€ì„ ë‹¨í’ (ë‚¨ì´ì„¬, ê²½ì£¼)
- ë¹„ì¹˜/ë°œë¦¬ (íŠ¸ë¡œí”¼ì»¬)

#### Tier 3 â€” ì´í›„

- ë² ë„¤ì¹˜ì•„, ì‚°í† ë¦¬ë‹ˆ
- ì‹œì¦Œ/ê¸°ë…ì¼ í…Œë§ˆ
- íŒíƒ€ì§€/ì‹œë„¤ë§ˆí‹±

### 7-2. í…Œë§ˆë³„ í”„ë¡¬í”„íŠ¸ í…œí”Œë¦¿ (ì˜ˆì‹œ)

#### ì œì£¼ í•´ë³€

```
A beautiful Korean couple standing on Hyeopjae Beach in Jeju Island,
crystal clear emerald water, Biyangdo island visible in the distance,
gentle waves lapping at their feet, {{poseDescription}},
{{timeOfDay}} light, {{season}} atmosphere,
professional Korean wedding photography,
shot on Canon EOS R5 with 85mm f/1.2 lens,
shallow depth of field, warm golden skin tones
```

ìŠ¤íƒ€ì¼ íŒŒë¼ë¯¸í„°:
- lighting: golden hour
- colorPalette: emerald green water, white sand, warm golden
- mood: serene, romantic, tropical paradise

#### íŒŒë¦¬ ì—í íƒ‘

```
Standing on Trocadero terrace with the Eiffel Tower perfectly framed behind them,
Champ de Mars gardens visible, Parisian rooftops in the distance,
early morning with few people, {{poseDescription}},
soft dawn light, warm pink-golden glow on the Eiffel Tower,
shot on Canon EOS R5 with 50mm f/1.2 lens,
shallow depth of field, classic Parisian romance
```

#### ê²½ë³µê¶ í•œë³µ

```
Standing in the courtyard of Gyeongbokgung Palace,
Geunjeongjeon main hall visible behind,
traditional Dancheong painted wooden columns,
elaborate traditional Korean wedding Hanbok,
bride in green jeogori and red chima with gold embroidery,
groom in dark blue durumagi,
{{poseDescription}}, clear autumn afternoon,
shot on Canon EOS R5 with 50mm f/1.2 lens
```

### 7-3. ë°ì´í„° ëª¨ë¸

```ts
themes = pgTable('themes', {
  id: text('id').primaryKey(),              // 'jeju-beach'
  name: text('name').notNull(),             // 'ì œì£¼ í•´ë³€'
  nameEn: text('name_en').notNull(),
  category: text('category').notNull(),     // domestic | international | studio | fantasy
  description: text('description').notNull(),
  thumbnailUrl: text('thumbnail_url').notNull(),
  promptTemplate: text('prompt_template').notNull(),
  negativePrompt: text('negative_prompt').default(''),
  styleParameters: jsonb('style_parameters').default({}),
  backgroundPresets: jsonb('background_presets').default([]),
  compositeGuidance: jsonb('composite_guidance').default({}),
  isActive: boolean('is_active').default(true),
  sortOrder: integer('sort_order').default(0),
  createdAt: timestamp('created_at').defaultNow(),
});
```

---

## 8. ê¸°ìˆ  ì•„í‚¤í…ì²˜

### 8-1. Phase 1: ì»¤í”Œ ì§€ì› (í˜„ì¬ ì•„í‚¤í…ì²˜ í™•ì¥)

#### Provider ì¸í„°í˜ì´ìŠ¤ í™•ì¥

```ts
// lib/ai/providers/types.ts
export interface GenerationProvider {
  readonly providerType: ProviderType;
  generateImage(params: {
    prompt: string;
    imageUrl: string;
    imageUrls?: string[];       // NEW: ì»¤í”Œìš© ë³µìˆ˜ ì´ë¯¸ì§€
    modelConfig: AIModel;
    variationIndex: number;
    negativePrompt?: string;    // NEW: ë„¤ê±°í‹°ë¸Œ í”„ë¡¬í”„íŠ¸
  }): Promise<ImageOutput>;
}
```

#### Gemini ì»¤í”Œ êµ¬í˜„

```ts
// 2ê°œ inlineDataë¡œ ì»¤í”Œ í”„ë¡¬í”„íŠ¸ ìƒì„±
const parts = [
  { inlineData: { mimeType: 'image/png', data: groomBase64 } },  // Image 1
  { inlineData: { mimeType: 'image/png', data: brideBase64 } },  // Image 2
  { text: couplePrompt }  // "Image 1 shows the groom. Image 2 shows the bride..."
];
```

#### OpenAI ì»¤í”Œ êµ¬í˜„

```ts
// ë³µìˆ˜ ì´ë¯¸ì§€ íŒŒì¼ â†’ images.edit()
const response = await openai.images.edit({
  model: 'gpt-image-1',
  image: [groomFile, brideFile],
  prompt: couplePrompt,
  size: '1024x1536',
});
```

### 8-2. Phase 3: ë©€í‹°ìŠ¤í… íŒŒì´í”„ë¼ì¸

#### íŒŒì´í”„ë¼ì¸ êµ¬ì¡°

```mermaid
flowchart TD
    UPLOAD["ğŸ“¸ ì‚¬ì§„ ì—…ë¡œë“œ<br/>(ì‹ ë‘ + ì‹ ë¶€)"] --> S0

    subgraph Pipeline["ë©€í‹°ìŠ¤í… íŒŒì´í”„ë¼ì¸"]
        S0["Step 0: FACE_EXTRACT<br/>ì–¼êµ´ ì¶”ì¶œ/ë³´ì •<br/><i>Azure Face API + Sharp</i>"]
        S1["Step 1: SCENE_GENERATE<br/>ë°°ê²½ ìƒì„± or í”„ë¦¬ì…‹ ì„ íƒ<br/><i>Flux Pro / í”„ë¦¬ì…‹ S3</i>"]
        S2["Step 2: COMPOSITE<br/>ì–¼êµ´ + ë°°ê²½ í•©ì„±<br/><i>GPT Image 1 / Gemini</i>"]
        S3["Step 3: POSTPROCESS<br/>ìƒ‰ë³´ì •, ì—…ìŠ¤ì¼€ì¼<br/><i>Flux Dev / Sharp</i>"]

        S0 --> Q0{"í’ˆì§ˆ ê²Œì´íŠ¸<br/>confidence > 0.8"}
        Q0 -->|"Pass"| S1
        Q0 -->|"Fail"| R0["ì¬ì‹œë„<br/>(ìµœëŒ€ 3íšŒ)"]
        R0 --> S0

        S1 --> Q1{"í’ˆì§ˆ ê²Œì´íŠ¸<br/>ì›ì¹˜ ì•ŠëŠ” ì–¼êµ´ 0ëª…"}
        Q1 -->|"Pass"| S2
        Q1 -->|"Fail"| R1["ì¬ì‹œë„"]
        R1 --> S1

        S2 --> Q2{"í’ˆì§ˆ ê²Œì´íŠ¸<br/>face similarity > 0.6"}
        Q2 -->|"Pass"| S3
        Q2 -->|"Fail"| R2["ì¬ì‹œë„ or<br/>Fallback ì „ëµ"]
        R2 --> S2

        S3 --> DONE
    end

    DONE["âœ… ìµœì¢… ê²°ê³¼ë¬¼"] --> SELECT["ì‚¬ìš©ì ì„ íƒ/ì¬ìƒì„±"]
    SELECT -->|"ìŠ¤í… ì¬ìƒì„±"| S1

    style S0 fill:#E8F5E9,stroke:#333
    style S1 fill:#E3F2FD,stroke:#333
    style S2 fill:#FFF3E0,stroke:#333
    style S3 fill:#F3E5F5,stroke:#333
    style DONE fill:#C8E6C9,stroke:#333
    style Q0 fill:#FFF9C4,stroke:#333
    style Q1 fill:#FFF9C4,stroke:#333
    style Q2 fill:#FFF9C4,stroke:#333
```

ê° ìŠ¤í… ê²°ê³¼ë¥¼ ì‚¬ìš©ìì—ê²Œ ë³´ì—¬ì£¼ê³ , ë§ˆìŒì— ì•ˆ ë“œëŠ” ìŠ¤í…ë§Œ ì¬ìƒì„± ê°€ëŠ¥.

#### DB ìŠ¤í‚¤ë§ˆ

```mermaid
erDiagram
    User ||--o{ PipelineRun : "ìƒì„±"
    PipelineRun ||--o{ PipelineStep : "í¬í•¨"
    PipelineRun ||--o{ PipelineArtifact : "ì‚°ì¶œë¬¼"
    PipelineRun }o--|| Theme : "í…Œë§ˆ ì‚¬ìš©"
    PipelineStep ||--o{ PipelineArtifact : "ìƒì„±"
    PipelineRun ||--o| AIGeneration : "ë ˆê±°ì‹œ í˜¸í™˜"

    User {
        string id PK
        int aiCredits "ê¸°ë³¸ 2"
    }

    PipelineRun {
        uuid id PK
        string userId FK
        string invitationId FK "nullable"
        enum type "single | couple"
        string themeId FK
        enum status "CREATED | RUNNING | PAUSED | COMPLETED | FAILED"
        int currentStepIndex
        jsonb config
        text_array finalOutputUrls
        string selectedUrl "nullable"
        decimal totalCost
        int totalCreditsUsed
    }

    PipelineStep {
        uuid id PK
        uuid pipelineRunId FK
        enum stepType "FACE_EXTRACT | SCENE_GENERATE | COMPOSITE | POSTPROCESS"
        int stepIndex
        enum status "PENDING | RUNNING | COMPLETED | FAILED | SKIPPED"
        int attemptCount
        string providerType
        string modelId
        text promptUsed
        decimal cost
        int durationMs
    }

    PipelineArtifact {
        uuid id PK
        uuid pipelineRunId FK
        uuid stepId FK "nullable"
        enum artifactType "INPUT_PHOTO | FACE_CROP | SCENE_BG | COMPOSITE_RAW | POSTPROCESSED"
        enum role "groom | bride | couple | scene"
        string s3Key
        string cdnUrl
        decimal qualityScore "0.0 ~ 1.0"
        decimal faceSimilarityScore "0.0 ~ 1.0"
    }

    Theme {
        string id PK
        string name
        string category "domestic | international | studio | fantasy"
        text promptTemplate
        jsonb styleParameters
        jsonb backgroundPresets
        boolean isActive
    }

    AIGeneration {
        string id PK
        uuid pipelineRunId FK "nullable - ë ˆê±°ì‹œ í˜¸í™˜"
        text_array generatedUrls
        string selectedUrl
    }
```

#### íŒŒì´í”„ë¼ì¸ ì‹¤í–‰ê¸°

```ts
// lib/ai/pipeline/executor.ts
async function executePipeline(runId: string, callbacks: SSECallbacks) {
  const steps = await getSteps(runId);

  for (const step of steps) {
    if (step.status === 'COMPLETED') continue;

    const handler = getStepHandler(step.stepType);
    const result = await handler.execute(run, step, callbacks);

    // í’ˆì§ˆ ê²Œì´íŠ¸
    if (!await handler.qualityCheck(result)) {
      if (step.attemptCount < MAX_RETRIES) {
        await retryStep(step);
        continue;
      }
      // PAUSED â†’ ì‚¬ìš©ì íŒë‹¨
      return;
    }
  }
}
```

#### ì»¤í”Œ í•©ì„± ì „ëµ

```mermaid
flowchart TD
    INPUT["ì…ë ¥: ì‹ ë‘ ì–¼êµ´ í¬ë¡­ + ì‹ ë¶€ ì–¼êµ´ í¬ë¡­ + ë°°ê²½"]

    INPUT --> A["Strategy A (Primary)<br/>GPT Image 1 edit"]
    A --> A1["3ê°œ í›„ë³´ ë™ì‹œ ìƒì„±"]
    A1 --> AQ{"ì–¼êµ´ ìœ ì‚¬ë„ ê²€ì¦<br/>(Azure Face verify)"}
    AQ -->|"cosine > 0.6"| BEST["ìµœê³  í’ˆì§ˆ 1ì¥ ì„ íƒ"]
    AQ -->|"3íšŒ ì‹¤íŒ¨"| B

    B["Strategy B (Fallback)<br/>PhotoMaker ìˆœì°¨"]
    B --> B1["1. Flux Proë¡œ ì»¤í”Œ ì”¬ ìƒì„±<br/>(generic ì–¼êµ´)"]
    B1 --> B2["2. PhotoMakerë¡œ ì‹ ë‘ ì–¼êµ´ í•©ì„±<br/>(inpainting)"]
    B2 --> B3["3. PhotoMakerë¡œ ì‹ ë¶€ ì–¼êµ´ í•©ì„±<br/>(inpainting)"]
    B3 --> BQ{"ì–¼êµ´ ìœ ì‚¬ë„ ê²€ì¦"}
    BQ -->|"Pass"| BEST
    BQ -->|"Fail"| FAIL["âŒ ì‹¤íŒ¨ â†’ ì‚¬ìš©ì ì•Œë¦¼"]

    BEST --> DONE["âœ… COMPOSITE ì™„ë£Œ"]

    style A fill:#E3F2FD,stroke:#333
    style B fill:#FFF3E0,stroke:#333
    style BEST fill:#C8E6C9,stroke:#333
    style FAIL fill:#FFCDD2,stroke:#333
```

#### í’ˆì§ˆ ê²Œì´íŠ¸

| ìŠ¤í… | ê²€ì¦ í•­ëª© | ê¸°ì¤€ |
|------|----------|------|
| FACE_EXTRACT | ì–¼êµ´ ê°ì§€ confidence | > 0.80 |
| FACE_EXTRACT | ì¸ë¬¼ ìˆ˜ | ì •í™•íˆ 1ëª… |
| SCENE_GENERATE | ì›ì¹˜ ì•ŠëŠ” ì–¼êµ´ | 0ëª… |
| COMPOSITE | ì–¼êµ´ ìœ ì‚¬ë„ (vs ì›ë³¸) | cosine > 0.6 |
| COMPOSITE | ì¸ë¬¼ ìˆ˜ | ì»¤í”Œ: 2ëª…, ë‹¨ì¼: 1ëª… |
| POSTPROCESS | í•´ìƒë„ | >= ì…ë ¥ í•´ìƒë„ |

#### API ì—”ë“œí¬ì¸íŠ¸

```
POST   /api/ai/pipeline              # íŒŒì´í”„ë¼ì¸ ìƒì„±
GET    /api/ai/pipeline/{id}          # ìƒíƒœ ì¡°íšŒ
GET    /api/ai/pipeline/{id}/stream   # SSE ìŠ¤íŠ¸ë¦¬ë° ì‹¤í–‰
POST   /api/ai/pipeline/{id}/steps/{n}/retry  # ìŠ¤í… ì¬ìƒì„±
POST   /api/ai/pipeline/{id}/select   # ìµœì¢… ì‚¬ì§„ ì„ íƒ
GET    /api/ai/themes                 # í…Œë§ˆ ëª©ë¡
```

### 8-3. ë¹„ìš© ì¶”ì •

#### ë‹¨ì¼ ìƒì„± (í˜„ì¬)
```
Flux Dev Ã— 4ì¥ = $0.10
GPT Image 1 Ã— 4ì¥ = $0.16
Gemini Flash Ã— 4ì¥ = $0.08
```

#### ë©€í‹°ìŠ¤í… íŒŒì´í”„ë¼ì¸ (Phase 3)
```
ì–¼êµ´ ê°ì§€:  ~$0.004  (Azure Face API)
ë°°ê²½ ìƒì„±:  ~$0.15   (Flux Pro Ã— 3í›„ë³´)
í•©ì„±:      ~$0.24   (GPT Image 1 Ã— 3í›„ë³´)
í›„ì²˜ë¦¬:    ~$0.03   (Flux Dev)
ê²€ì¦:      ~$0.006  (Azure Face verify)
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
í•©ê³„:      ~$0.43 (ì •ìƒ) ~ $0.60 (ì¬ì‹œë„ í¬í•¨)
```

ê°€ê²© 19,900ì› ê¸°ì¤€ â†’ ì›ê°€ $0.60 = ~900ì› â†’ ë§ˆì§„ 95%+

---

## 9. íŒŒì¼ ë³€ê²½ ìš”ì•½

### ìˆ˜ì •í•˜ëŠ” ê¸°ì¡´ íŒŒì¼

| íŒŒì¼ | ë³€ê²½ ë‚´ìš© | Phase |
|------|----------|-------|
| `lib/ai/providers/types.ts` | imageUrls[], negativePrompt ì¶”ê°€ | 1 |
| `lib/ai/providers/openai.ts` | ë³µìˆ˜ ì´ë¯¸ì§€, input_fidelity | 1 |
| `lib/ai/providers/gemini.ts` | ë³µìˆ˜ inlineData | 1 |
| `lib/ai/prompts.ts` | í”„ë¡¬í”„íŠ¸ ì „ë©´ ë¦¬ë‰´ì–¼ | 1 |
| `lib/ai/generate.ts` | role: COUPLE, imageUrls | 1 |
| `lib/ai/models.ts` | ëª¨ë¸ ì—…ë°ì´íŠ¸, InstantID ì¬í™œì„±í™” ê²€í†  | 1 |
| `lib/ai/face-detection.ts` | Azure Face verify ì¶”ê°€ | 3 |
| `db/schema.ts` | themes, pipeline í…Œì´ë¸”ë“¤ | 2, 3 |
| API routes | themeId, COUPLE ì§€ì› | 1, 2 |

### ìƒˆë¡œ ë§Œë“œëŠ” íŒŒì¼

| íŒŒì¼ | ì—­í•  | Phase |
|------|------|-------|
| `scripts/poc-couple.ts` | POC í…ŒìŠ¤íŠ¸ ìŠ¤í¬ë¦½íŠ¸ | 0 |
| `lib/ai/themes/registry.ts` | í…Œë§ˆ ì‹œë“œ ë°ì´í„° | 2 |
| `lib/ai/themes/prompt-builder.ts` | í…œí”Œë¦¿ ë Œë”ë§ | 2 |
| `lib/ai/pipeline/executor.ts` | íŒŒì´í”„ë¼ì¸ ì‹¤í–‰ê¸° | 3 |
| `lib/ai/pipeline/types.ts` | ìŠ¤í… í•¸ë“¤ëŸ¬ ì¸í„°í˜ì´ìŠ¤ | 3 |
| `lib/ai/pipeline/quality.ts` | í’ˆì§ˆ ìŠ¤ì½”ì–´ë§ | 3 |
| `lib/ai/pipeline/steps/*.ts` | 4ê°œ ìŠ¤í… í•¸ë“¤ëŸ¬ | 3 |
| `schemas/pipeline.ts` | Zod ìŠ¤í‚¤ë§ˆ | 3 |
| `types/pipeline.ts` | TypeScript íƒ€ì… | 3 |
| `app/api/ai/themes/route.ts` | í…Œë§ˆ API | 2 |
| `app/api/ai/pipeline/**` | íŒŒì´í”„ë¼ì¸ API | 3 |

---

## 10. ì‹¤í–‰ ë¡œë“œë§µ

```mermaid
gantt
    title AI ì›¨ë”© í¬í†  ì‹¤í–‰ ë¡œë“œë§µ
    dateFormat YYYY-MM-DD
    axisFormat %m/%d

    section Phase 0: POC
    POC ìŠ¤í¬ë¦½íŠ¸ ì‘ì„±              :p0a, 2026-02-12, 1d
    GPT Image 1 ì»¤í”Œ í…ŒìŠ¤íŠ¸         :p0b, after p0a, 1d
    Gemini ì»¤í”Œ í…ŒìŠ¤íŠ¸              :p0c, after p0a, 1d
    í’ˆì§ˆ í‰ê°€ + Go/No-Go            :milestone, p0m, after p0c, 0d

    section Phase 1: ì»¤í”Œ ì§€ì›
    Provider ì¸í„°í˜ì´ìŠ¤ í™•ì¥         :p1a, after p0m, 1d
    Gemini ì»¤í”Œ êµ¬í˜„                :p1b, after p1a, 1d
    OpenAI ì»¤í”Œ êµ¬í˜„                :p1c, after p1a, 1d
    í”„ë¡¬í”„íŠ¸ ì „ë©´ ë¦¬ë‰´ì–¼             :p1d, after p1a, 2d
    role COUPLE + í¬ì¦ˆ í…œí”Œë¦¿        :p1e, after p1d, 1d

    section Phase 2: í…Œë§ˆ ì‹œìŠ¤í…œ
    themes í…Œì´ë¸” + ë§ˆì´ê·¸ë ˆì´ì…˜     :p2a, after p1e, 1d
    Tier 1 í…Œë§ˆ 4ì¢… ë°ì´í„°          :p2b, after p2a, 2d
    í”„ë¡¬í”„íŠ¸ í…œí”Œë¦¿ ë Œë”ë§           :p2c, after p2a, 1d
    API + ì—”ë“œí¬ì¸íŠ¸ í™•ì¥            :p2d, after p2c, 1d

    section Phase 3: íŒŒì´í”„ë¼ì¸
    DB ìŠ¤í‚¤ë§ˆ 3ê°œ í…Œì´ë¸”             :p3a, after p2d, 1d
    íŒŒì´í”„ë¼ì¸ ì‹¤í–‰ê¸°                :p3b, after p3a, 2d
    4ê°œ ìŠ¤í… í•¸ë“¤ëŸ¬                 :p3c, after p3b, 3d
    í’ˆì§ˆ ê²Œì´íŠ¸ (Face verify)        :p3d, after p3c, 2d
    SSE ìŠ¤íŠ¸ë¦¬ë° + ì¬ìƒì„± API        :p3e, after p3d, 2d
```

### Phase 0: POC â€” ì»¤í”Œ í•©ì„± í’ˆì§ˆ ê²€ì¦

> **Gate**: ì´ê²Œ ì•ˆ ë˜ë©´ ë‚˜ë¨¸ì§€ ì „ë¶€ ì¬ì„¤ê³„

- `scripts/poc-couple.ts` ì‘ì„±
- GPT Image 1 + Gemini 2.5 Flashë¡œ ì»¤í”Œ ì›¨ë”© ì‚¬ì§„ ìƒì„± í…ŒìŠ¤íŠ¸
- ê°œì„ ëœ í”„ë¡¬í”„íŠ¸ (ì–¼êµ´ ë³´ì¡´ + í¬í† ë¦¬ì–¼ë¦¬ì¦˜ ë¸”ë¡) ì ìš©
- ê²°ê³¼: ìƒ˜í”Œ ì´ë¯¸ì§€ + í’ˆì§ˆ í‰ê°€ â†’ Go/No-Go ê²°ì •

### Phase 1: ì»¤í”Œ ì§€ì› + í”„ë¡¬í”„íŠ¸ ê°œì„ 

- Provider ì¸í„°í˜ì´ìŠ¤ í™•ì¥ (imageUrls[], negativePrompt)
- Gemini/OpenAI ì»¤í”Œ êµ¬í˜„
- í”„ë¡¬í”„íŠ¸ ì „ë©´ ë¦¬ë‰´ì–¼ (êµ¬ì¡°í™”ëœ ë¸”ë¡ ì‹œìŠ¤í…œ)
- role: 'COUPLE' ì¶”ê°€
- ì»¤í”Œ í¬ì¦ˆ í…œí”Œë¦¿

### Phase 2: í…Œë§ˆ ì‹œìŠ¤í…œ

- themes DB í…Œì´ë¸” + ë§ˆì´ê·¸ë ˆì´ì…˜
- Tier 1 í…Œë§ˆ 4ì¢… ì‹œë“œ ë°ì´í„°
- í”„ë¡¬í”„íŠ¸ í…œí”Œë¦¿ ë Œë”ë§ (`{{placeholder}}` ì¹˜í™˜)
- API + ê¸°ì¡´ ì—”ë“œí¬ì¸íŠ¸ í™•ì¥ (themeId íŒŒë¼ë¯¸í„°)

### Phase 3: ë©€í‹°ìŠ¤í… íŒŒì´í”„ë¼ì¸

- DB ìŠ¤í‚¤ë§ˆ 3ê°œ í…Œì´ë¸” (pipelineRuns, pipelineSteps, pipelineArtifacts)
- íŒŒì´í”„ë¼ì¸ ì‹¤í–‰ê¸° + 4ê°œ ìŠ¤í… í•¸ë“¤ëŸ¬
- í’ˆì§ˆ ê²Œì´íŠ¸ (Azure Face verify)
- SSE ìŠ¤íŠ¸ë¦¬ë° + ìŠ¤í… ì¬ìƒì„± API

---

## 11. ì—´ë¦° ì§ˆë¬¸

| # | ì§ˆë¬¸ | ì˜í–¥ ë²”ìœ„ |
|---|------|----------|
| 1 | íŒŒì´í”„ë¼ì¸ë‹¹ ìµœì¢… ì‚¬ì§„ ëª‡ ì¥? (3í›„ë³´ ì¤‘ ìë™ 1ì¥ vs ë‹¤ ë³´ì—¬ì£¼ê¸°) | UI, API |
| 2 | ìŠ¤í…ë³„ ì¤‘ê°„ ê²°ê³¼ë¥¼ ì‚¬ìš©ìì—ê²Œ ë³´ì—¬ì¤„ì§€? | UX, ìŠ¤íŠ¸ë¦¬ë° |
| 3 | í…Œë§ˆë³„ ì°¨ë“± ê°€ê²©? í”„ë¦¬ë¯¸ì—„ í…Œë§ˆ? | ê³¼ê¸ˆ, DB |
| 4 | ë°°ê²½ í”„ë¦¬ì…‹ì„ ì§ì ‘ ì´¬ì˜/êµ¬ë§¤í• ì§€, AI ìƒì„±í• ì§€? | ì½˜í…ì¸ , ë¹„ìš© |
| 5 | GPT Image 1.5 ì‹¤ì œ ì‚¬ìš© ê°€ëŠ¥ ì—¬ë¶€ | ëª¨ë¸ ì „ëµ |

---

## ì°¸ê³  ìë£Œ

### OpenAI / GPT Image
- GPT Image Prompting Guide (OpenAI Cookbook)
- Generate Images with High Input Fidelity (OpenAI Cookbook)
- Image Generation Guide (OpenAI API Docs)

### Gemini
- Gemini 2.5 Flash Image (Google Developers Blog)
- How to Prompt Gemini Image Generation (Google Developers Blog)

### Face Preservation
- PhotoMaker V2 (TencentARC/GitHub)
- InstantID (Official)
- IP-Adapter FaceID comparison

### Korean Wedding Photography
- Korean Style Wedding Photography reference
- Korean Pre-Wedding Photography trends
